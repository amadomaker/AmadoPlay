<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <link rel="stylesheet" href="../src/css/global.css">
    <!-- Fonte Montserrat apenas para esta p√°gina -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;600;700&display=swap" rel="stylesheet">
    <title>Conte as Bolhas M√°gicas! ü´ß</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            user-select: none;
        }

        /* Container principal */
        #mainContainer {
            width: 90%;
            max-width: 1200px;
            height: 85vh;
            max-height: 800px;
            background: rgba(255, 255, 255, 0.98);
            border-radius: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* Header com t√≠tulo */
        #header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 15px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        #activityTitle {
            font-size: 28px;
            font-weight: bold;
            color: white;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }
        /* ======= Safe-area + unidades modernas ======= */
        :root{
        /* iOS safe area ‚Äì volta 0 se n√£o existir */
        --safe-bottom: env(safe-area-inset-bottom, 0px);
        --safe-top: env(safe-area-inset-top, 0px);
        /* fallback para o truque de 100vh via JS (ver se√ß√£o 3) */
        --app-vh: 100vh;
        }

        /* O body pode rolar em telas pequenas; antes estava hidden e cortava */
        @media (max-width: 768px){
        body{
            overflow-y: auto;
        }
        }

        /* Container principal: usar dvh (√°rea √∫til real) com fallbacks */
        #mainContainer{
        /* desktop mant√©m como est√°; em mobile use a √°rea √∫til real */
        height: 92dvh;                 /* browsers modernos (inclui iOS 16+ e Android) */
        height: calc(var(--app-vh) * 0.92); /* fallback JS p/ Safari antigo */
        max-height: none;
        /* espa√ßo para a barra do iPhone */
        padding-bottom: calc(var(--safe-bottom) + 12px);
        }

        /* √Årea do conte√∫do tamb√©m respeita safe area, evitando o corte do bot√£o */
        #contentArea{
        padding-bottom: calc(var(--safe-bottom) + 12px);
        overflow: hidden; /* o jogo n√£o rola; a p√°gina sim */
        }

        /* Menu inicial: garante que tudo caiba em telas baixinhas */
        @media (max-height: 700px){
        #menuTitle{ font-size: 24px; }
        #menuCharacter{ width: 90px; height: 115px; }
        #difficultySelector{ gap: 8px; }
        .difficultyBtn{ padding: 12px 22px; font-size: 18px; }
        #startBtn{ padding: 16px 40px; font-size: 24px; }
        }

        /* HUD e elementos no jogo menores em telas baixinhas */
        @media (max-height: 700px){
        #gameHUD{
            top: 8px;
            padding: 8px 14px;
            gap: 6px;
        }
        #targetDisplay{ font-size: 16px; }
        #counter{ font-size: 20px; }
        #progressBar{ width: 130px; height: 6px; }
        }

        /* A varinha (lupa) nunca encosta na barra do iPhone */
        #bubbleWand{
        bottom: calc(20px + var(--safe-bottom));
        }

        /* Bot√µes flutuantes no jogo: afastar do topo com notch */
        #gameControls{
        top: calc(12px + var(--safe-top));
        }

        /* Modal: d√° um respiro com a safe-area tamb√©m */
        #victoryModal .victoryContent{
        margin-bottom: var(--safe-bottom);
        }


        /* √Årea de conte√∫do */
        #contentArea {
            flex: 1;
            position: relative;
            overflow: hidden;
        }

        /* Menu inicial */
        #startMenu {
            position: absolute;
            width: 100%;
            height: 100%;
            background: transparent;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 500;
            transition: all 0.5s ease-out;
        }

        /* V√≠deo de fundo responsivo */
        .bg-video{
          position:absolute;
          inset:0;
          width:100%;
          height:100%;
          object-fit:cover;
          z-index:0;
          pointer-events:none;
        }

        /* V√©u para legibilidade do texto */
        .startMenu-overlay{
          position:absolute;
          inset:0;
          z-index:1;
          pointer-events:none;
          background: linear-gradient(
            180deg, 
            rgba(0,0,0,.10) 0%,
            rgba(255,255,255,.20) 50%,
            rgba(255,255,255,.35) 100%
          );
        }

        /* Conte√∫do do menu acima do v√≠deo */
        .startMenu-content{
          position:relative;
          z-index:2;
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          padding: 0;
          background: transparent;
          border-radius: 0;
          box-shadow: none;
          max-width: 600px;
          margin-top: 20vh;
        }

        /* Esconder menu */
        #startMenu.hidden{
          opacity:0;
          pointer-events:none;
          transform:scale(.8);
          transition:all .5s ease-out;
        }

        #menuTitle {
            font-size: 42px;
            color: white;
            margin-bottom: 30px;
            font-weight: bold;
            text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.8);
            animation: floatTitle 3s ease-in-out infinite;
        }

        @keyframes floatTitle {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        /* Seletor de dificuldade */
        #difficultySelector {
            display: flex;
            gap: 20px;
            margin-bottom: 25px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .difficultyBtn {
            padding: 16px 38px;
            font-size: 20px; /* mais leg√≠vel */
            font-family: 'Montserrat', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-weight: 600;
            border: 3px solid white;
            border-radius: 25px;
            background: rgba(255, 255, 255, 0.9);
            color: #764ba2;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .difficultyBtn:hover {
            background: white;
            color: #764ba2;
            transform: scale(1.05);
        }

        .difficultyBtn.selected {
            background: #764ba2;
            color: white;
            border-color: #764ba2;
        }

        #startBtn {
            padding: 20px 56px;
            font-size: 28px; /* mais vis√≠vel */
            font-family: 'Montserrat', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: 3px solid white;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
            animation: pulseButton 2s infinite;
        }

        @keyframes pulseButton {
            0%, 100% { transform: scale(1); box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4); }
            50% { transform: scale(1.05); box-shadow: 0 15px 40px rgba(0, 0, 0, 0.6); }
        }

        #startBtn:hover {
            transform: scale(1.1);
        }

        /* √Årea do jogo */
        #gameContainer {
            width: 100%;
            height: 100%;
            position: relative;
            display: none;
        }

        #gameContainer.active {
            display: block;
        }

        /* HUD do jogo */
        #gameHUD {
            position: absolute;
            top: 20px;
            left: 20px;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            gap: 10px;
            background: rgba(255, 255, 255, 0.95);
            padding: 15px 40px;
            border-radius: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            z-index: 100;
        }

        #roundInfo {
            font-size: 14px;
            color: #666;
            font-weight: bold;
        }

        #targetDisplay {
            font-size: 22px;
            font-weight: bold;
            color: #764ba2;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        #counter {
        font-size: 28px;
        font-weight: bold;
        background: linear-gradient(135deg, #667eea, #764ba2);
        background-clip: text;             /* vers√£o padr√£o */
        -webkit-background-clip: text;     /* vers√£o com prefixo */
        -webkit-text-fill-color: transparent;
    }


        /* Indicador de progresso */
        #progressBar {
            width: 200px;
            height: 8px;
            background: rgba(0, 0, 0, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 5px;
        }

        #progressFill {
            height: 100%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            transition: width 0.3s ease;
            width: 0%;
        }

        /* Controles do jogo */
        #gameControls {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 100;
        }

        .gameControlBtn {
            width: 55px;
            height: 55px;
            border: none;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.9);
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .gameControlBtn:hover {
            transform: scale(1.1);
            background: white;
        }

        /* Varinha de sab√£o */
        #bubbleWand {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 100px;
            z-index: 50;
            pointer-events: none;
            animation: wandFloat 3s ease-in-out infinite;
        }

        @keyframes wandFloat {
            0%, 100% { transform: translateX(-50%) translateY(0) rotate(-5deg); }
            50% { transform: translateX(-50%) translateY(-10px) rotate(5deg); }
        }

        .wandCircle {
            width: 100%;
            height: 100%;
            border: 6px solid #FFD700;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.8), rgba(135, 206, 235, 0.4));
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
        }

        .wandHandle {
            position: absolute;
            bottom: -35px;
            left: 50%;
            transform: translateX(-50%);
            width: 16px;
            height: 40px;
            background: linear-gradient(180deg, #8B4513, #D2691E);
            border-radius: 0 0 8px 8px;
        }

        /* Bolhas */
        /* Bolhas (com hitbox maior e toque mais responsivo) */
        .bubble {
        position: absolute;
        border-radius: 50%;
        cursor: pointer;
        /* ‚Äúanel‚Äù clic√°vel invis√≠vel ao redor da bolha */
        padding: clamp(6px, 1.2vw, 14px);
        background-clip: content-box;         /* cor s√≥ no miolo, padding vira hitbox */
        transition: transform 0.12s ease;
        pointer-events: all;
        touch-action: manipulation;           /* reduz atraso no toque */
        -webkit-tap-highlight-color: transparent;
        will-change: transform;               /* performance */
        }

        .bubble:hover {
        transform: scale(1.06);
        }

        .bubble::before {
        content: '';
        position: absolute;
        top: 15%;
        left: 20%;
        width: 30%;
        height: 30%;
        background: radial-gradient(circle, rgba(255, 255, 255, 0.9), transparent);
        border-radius: 50%;
        pointer-events: none;                 /* n√£o bloqueia o toque */
        }

        /* Efeito de estouro */
        .pop {
        position: absolute;
        pointer-events: none;
        animation: popAnimation 0.4s ease-out forwards;
        }

        @keyframes popAnimation {
        0%   { transform: scale(1); opacity: 1; }
        100% { transform: scale(2); opacity: 0; }
        }

        .popParticle {
        position: absolute;
        width: 8px;
        height: 8px;
        background: radial-gradient(circle, #fff, transparent);
        border-radius: 50%;
        animation: particleFly 0.6s ease-out forwards;
        }

        @keyframes particleFly {
        100% {
            transform: translate(var(--tx), var(--ty));
            opacity: 0;
        }
        }


        /* Modal de vit√≥ria */
        #victoryModal {
            position: fixed;           /* cobre toda a viewport */
            inset: 0;                  /* top/left/right/bottom: 0 */
            background: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;             /* acima de confetes e HUD */
            pointer-events: auto;      /* garante clique */
        }

        #victoryModal.show {
            display: flex;
            animation: fadeIn 0.3s ease-out;
        }

        .victoryContent {
            background: white;
            padding: 30px;
            border-radius: 30px;
            text-align: center;
            animation: bounceIn 0.5s ease-out;
            max-width: 450px;
        }

        @keyframes bounceIn {
            0% { transform: scale(0); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        #victoryCharacter {
            width: 120px;
            height: 160px;
            margin: 15px auto;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            animation: victoryDance 1s ease-in-out infinite;
        }

        @keyframes victoryDance {
            0%, 100% { transform: rotate(-5deg) scale(1); }
            25% { transform: rotate(5deg) scale(1.1); }
            50% { transform: rotate(-5deg) scale(1); }
            75% { transform: rotate(5deg) scale(1.1); }
        }

        .victoryContent h2 {
            font-size: 32px;
            color: #764ba2;
            margin-bottom: 15px;
        }

        .victoryButtons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 25px;
        }

        .victoryBtn {
            padding: 14px 28px;
            font-size: 18px;
            font-family: 'Montserrat', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-weight: 600;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .nextRoundBtn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .menuBtn {
            background: white;
            color: #764ba2;
            border: 2px solid #764ba2;
        }

        .victoryBtn:hover {
            transform: scale(1.05);
        }

        /* Confete */
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            animation: confettiFall 3s linear forwards;
            z-index: 650;
            pointer-events: none; /* n√£o bloqueia cliques na vit√≥ria */
        }

        @keyframes confettiFall {
            0% {
                transform: translateY(-100vh) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }

        /* Responsividade Tablet */
        @media (max-width: 1024px) {
            #mainContainer {
                width: 92%;
                height: 88vh;
            }

            #header {
                padding: 12px;
            }

            #activityTitle {
                font-size: 24px;
            }

            #menuTitle {
                font-size: 36px;
            }

            .startMenu-content {
                max-width: 450px;
                margin-top: 25vh;
            }

            #difficultySelector {
                flex-direction: row;
                gap: 15px;
            }

            .difficultyBtn { padding: 14px 28px; font-size: 18px; }

            #gameHUD {
                top: 20px;
                left: 50%;
                transform: translateX(-50%);
                align-items: center;
                padding: 12px 30px;
            }

            #targetDisplay {
                font-size: 20px;
            }

            #counter {
                font-size: 26px;
            }

            .gameControlBtn {
                width: 60px;
                height: 60px;
                font-size: 26px;
            }
        }

        /* Responsividade Mobile */
        @media (max-width: 768px) {
          .bg-video {
            object-position: 90% center;
}
            #mainContainer {
                width: 95%;
                height: 90vh;
                border-radius: 20px;
            }

            #header {
                padding: 10px;
            }

            #activityTitle {
                font-size: 20px;
            }

            #menuTitle {
                font-size: 28px;
                margin-bottom: 30px;
            }

            .startMenu-content {
                max-width: 90%;
                margin-top: 30vh;
            }

            #difficultySelector {
                flex-direction: column;
                gap: 15px;
                width: 100%;
            }

            .difficultyBtn { padding: 14px 28px; font-size: 18px; width: 100%; }

            #startBtn { padding: 18px 44px; font-size: 24px; }

            #gameHUD {
                top: 10px;
                left: 50%;
                transform: translateX(-50%);
                align-items: center;
                padding: 10px 20px;
                width: 90%;
            }

            #roundInfo {
                font-size: 12px;
            }

            #targetDisplay {
                font-size: 18px;
            }

            #counter {
                font-size: 22px;
            }

            #progressBar {
                width: 150px;
                height: 6px;
            }

            #gameControls {
                top: 10px;
                right: 10px;
                flex-direction: column;
                gap: 8px;
            }

            .gameControlBtn {
                width: 38px;
                height: 38px;
                font-size: 18px;
            }

            #bubbleWand {
                width: 70px;
                height: 70px;
                bottom: 20px;
            }

            .wandCircle {
                border-width: 4px;
            }

            .wandHandle {
                width: 12px;
                height: 30px;
                bottom: -25px;
            }

            .victoryContent {
                padding: 20px;
                width: 85%;
            }

            .victoryContent h2 {
                font-size: 26px;
            }

            .victoryButtons {
                flex-direction: column;
                gap: 10px;
            }

            .victoryBtn { padding: 12px 22px; font-size: 16px; width: 100%; }
        }

        /* Responsividade para telas muito pequenas */
        @media (max-width: 480px) {
            #mainContainer {
                width: 98%;
                height: 95vh;
                border-radius: 15px;
            }

            #activityTitle {
                font-size: 18px;
            }

            #menuTitle {
                font-size: 24px;
            }

            .startMenu-content {
                padding: 15px;
            }

            #gameHUD {
                width: 85%;
                padding: 8px 15px;
            }

            #counter {
                font-size: 20px;
            }
        }

        /* Acessibilidade */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        button:focus {
            outline: 3px solid #FFD700;
            outline-offset: 2px;
        }

        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0,0,0,0);
            white-space: nowrap;
            border: 0;
        }

        /* A11y: garanta que o overlay n√£o bloqueie cliques quando oculto */
        .accessibility-panel-overlay { pointer-events: none; }
        .accessibility-panel-overlay.active { pointer-events: auto; }

        /* A11y: evite que o √≠cone gigante extrapole do bot√£o flutuante */
        .accessibility-float-btn,
        #accessibilityFloatBtn { overflow: hidden; }

        /* Garante que o wrapper do VLibras n√£o intercepte cliques por padr√£o nesta p√°gina */
        [vw-plugin-wrapper] { pointer-events: none !important; }

        /* Ajuste do footer no mobile: menor, transl√∫cido e FIXO somente ao fim do conte√∫do (n√£o sobrep√µe) */
        @media (max-width: 768px) {
          .game-footer-bolhas {
            z-index: 1200;
            backdrop-filter: none;
            background: rgba(255,255,255,0.08); /* pr√≥ximo ao desktop, mais transl√∫cido */
            color: rgba(255,255,255,0.8);
            font-size: 0.62em;   /* menor que antes */
            padding: 4px 6px;     /* mais compacto */
            position: static !important;   /* deixa no fluxo da p√°gina */
            bottom: auto; left: auto; right: auto;
            margin-top: 8px;               /* pequeno respiro do container */
          }
        }

        /* Layout mobile: sem footer fixo; remove compensa√ß√µes e mant√©m respiro */
        @media (max-width: 768px) {
          /* Permite rolar para que o rodap√© nunca cubra conte√∫do */
          body { 
            overflow-y: auto; 
            display: flex;                /* empilha container + footer */
            flex-direction: column;       /* um embaixo do outro */
            justify-content: flex-start;  /* come√ßa do topo */
            align-items: center;          /* centraliza horizontalmente o container */
            min-height: 100vh;
          }
          @supports (height: 100dvh) {
            body { min-height: 100dvh; }
          }
          /* Respiro no topo e no fim do container */
          #mainContainer { margin: 8px 0 12px 0; }
          /* Bot√£o flutuante volta a usar offset padr√£o + safe-area */
          .accessibility-float-btn, #accessibilityFloatBtn {
            bottom: calc(12px + env(safe-area-inset-bottom, 0px));
          }
          /* Garante que o footer ocupe toda a largura do viewport */
          .game-footer-bolhas { align-self: stretch; }
        }
    </style>
</head>
<body>
    <div id="mainContainer">
        <!-- Header com t√≠tulo -->
        <div id="header">
            <h1 id="activityTitle">ü´ß Conte as Bolhas M√°gicas ü´ß</h1>
        </div>

        <!-- √Årea de conte√∫do -->
        <div id="contentArea">
            <!-- Menu Inicial -->
            <div id="startMenu">
              <!-- V√≠deo de fundo -->
              <video id="heroVideo"
                    class="bg-video"
                    autoplay
                    muted
                    loop
                    playsinline
                    preload="metadata"
                    poster="../src/assets/images/cenario-poster.jpg"
                    aria-hidden="true">
                <source src="../src/assets/videos/conta-bolhas-cenario.webm" type="video/webm">
                <source src="../src/assets/videos/conta-bolhas-cenario.mp4" type="video/mp4">
              </video>

              <!-- Leve v√©u para manter legibilidade -->
              <div class="startMenu-overlay"></div>

              <!-- Conte√∫do do menu -->
              <div class="startMenu-content" role="group" aria-label="Menu inicial">
                <h2 id="menuTitle">Vamos Contar Bolhas!</h2>
                <div id="difficultySelector">
                  <button class="difficultyBtn selected" data-level="1" type="button" onclick="selectDifficulty(1)">üåü F√°cil</button>
                  <button class="difficultyBtn" data-level="2" type="button" onclick="selectDifficulty(2)">‚≠ê M√©dio</button>
                  <button class="difficultyBtn" data-level="3" type="button" onclick="selectDifficulty(3)">üí´ Dif√≠cil</button>
                </div>
                <button id="startBtn" type="button" onclick="startGame()">INICIAR</button>
              </div>
            </div>

            <!-- √Årea do Jogo -->
            <div id="gameContainer">
                <!-- HUD do Jogo -->
                <div id="gameHUD">
                    <div id="roundInfo">
                        <span id="levelName">N√≠vel F√°cil</span> - Rodada <span id="currentRound">1</span> de <span id="totalRounds">5</span>
                    </div>
                    <div id="targetDisplay">
                        <span>üéØ Estoure:</span>
                        <span id="targetNumber">5</span>
                        <span>bolhas</span>
                    </div>
                    <div id="counter" aria-live="polite">
                        <span id="currentCount">0</span>/<span id="totalCount">5</span>
                    </div>
                    <div id="progressBar">
                        <div id="progressFill"></div>
                    </div>
                </div>

                <!-- Controles do Jogo -->
                <div id="gameControls">
                    <button class="gameControlBtn" id="menuBtnInGame" type="button" title="Menu Principal" onclick="backToMenu()">üè†</button>
                    <button class="gameControlBtn" id="soundBtn" type="button" title="Som" onclick="toggleSound()">üîä</button>
                    <button class="gameControlBtn" id="resetRoundBtn" type="button" title="Reiniciar" onclick="resetRound()">üîÑ</button>
                </div>

                <!-- Varinha de sab√£o -->
                <div id="bubbleWand">
                    <div class="wandCircle"></div>
                    <div class="wandHandle"></div>
                </div>
            </div>
        </div>

        <!-- Modal de Vit√≥ria -->
        <div id="victoryModal" role="dialog">
            <div class="victoryContent">
                <h2 id="victoryTitle">üéâ Parab√©ns! üéâ</h2>
                <div id="victoryCharacter"></div>
                <p id="victoryMessage">Voc√™ conseguiu!</p>
                <div class="victoryButtons">
                    <button class="victoryBtn menuBtn" id="victoryMenuBtn" type="button" onclick="backToMenu()">Menu Principal</button>
                    <button class="victoryBtn nextRoundBtn" id="nextActionBtn" type="button" onclick="nextAction()">Pr√≥xima Rodada</button>
                </div>
            </div>
        </div>

        <!-- √Årea para leitores de tela -->
        <div class="sr-only" aria-live="polite" id="screenReaderAnnouncements"></div>
    </div>
        <!-- Footer pequeno e discreto -->
    <footer class="game-footer-bolhas">
        <p>Ferramenta Educacional - Conta Bolhas | Cria√ß√£o e desenvolvimento por Jo√£o Jr</p>
    </footer>

    <script>
        // Estado do jogo
        const gameState = {
            target: 5,
            current: 0,
            level: 1,
            currentRound: 1,
            roundsPerLevel: 5,
            soundEnabled: true,
            bubbles: [],
            animationId: null,
            lastBubbleTime: 0,
            isPlaying: false,
            completedRounds: 0
        };

        // Configura√ß√µes por n√≠vel e rodada
        // ===== AJUSTE DE TAMANHO E LIMITE DE BOLHAS =====
        const levelConfig = {
        1: { 
            name: 'F√°cil',
            rounds: [
            { min: 3, max: 5,  size: { min: 80, max: 110 }, speed: { min: 0.8, max: 1.2 }, spawnRate: 2500, movement: 'straight',  maxBubbles: 10 },
            { min: 4, max: 6,  size: { min: 78, max: 105 }, speed: { min: 1.0, max: 1.4 }, spawnRate: 2300, movement: 'slight',    maxBubbles: 10 },
            { min: 5, max: 7,  size: { min: 74, max: 100 }, speed: { min: 1.2, max: 1.6 }, spawnRate: 2100, movement: 'slight',    maxBubbles: 10 },
            { min: 6, max: 8,  size: { min: 70, max:  95 }, speed: { min: 1.4, max: 1.8 }, spawnRate: 1900, movement: 'moderate',  maxBubbles: 10 },
            { min: 7, max: 10, size: { min: 66, max:  90 }, speed: { min: 1.6, max: 2.0 }, spawnRate: 1700, movement: 'moderate',  maxBubbles: 10 }
            ]
        },
        2: { 
            name: 'M√©dio',
            rounds: [
            { min: 6,  max:  9, size: { min: 62, max: 84 }, speed: { min: 1.5, max: 2.2 }, spawnRate: 1600, movement: 'moderate', maxBubbles: 9 },
            { min: 7,  max: 11, size: { min: 58, max: 80 }, speed: { min: 1.8, max: 2.6 }, spawnRate: 1400, movement: 'zigzag',   maxBubbles: 9 },
            { min: 8,  max: 13, size: { min: 54, max: 76 }, speed: { min: 2.0, max: 2.9 }, spawnRate: 1200, movement: 'zigzag',   maxBubbles: 9 },
            { min: 10, max: 14, size: { min: 52, max: 74 }, speed: { min: 2.2, max: 3.1 }, spawnRate: 1100, movement: 'curved',   maxBubbles: 8 },
            { min: 12, max: 15, size: { min: 50, max: 72 }, speed: { min: 2.4, max: 3.3 }, spawnRate: 1000, movement: 'curved',   maxBubbles: 8 }
            ]
        },
        3: { 
            name: 'Dif√≠cil',
            rounds: [
            { min: 10, max: 14, size: { min: 50, max: 70 }, speed: { min: 2.5, max: 3.5 }, spawnRate: 900,  movement: 'curved',   maxBubbles: 8 },
            { min: 12, max: 16, size: { min: 48, max: 68 }, speed: { min: 2.8, max: 3.8 }, spawnRate: 850,  movement: 'random',   maxBubbles: 8 },
            { min: 14, max: 18, size: { min: 46, max: 66 }, speed: { min: 3.0, max: 4.0 }, spawnRate: 800,  movement: 'random',   maxBubbles: 8 },
            { min: 16, max: 19, size: { min: 44, max: 64 }, speed: { min: 3.2, max: 4.2 }, spawnRate: 750,  movement: 'chaotic',  maxBubbles: 7 },
            { min: 18, max: 20, size: { min: 42, max: 62 }, speed: { min: 3.4, max: 4.4 }, spawnRate: 700,  movement: 'chaotic',  maxBubbles: 7 }
            ]
        }
        };


        // Cores vibrantes para bolhas
        const bubbleColors = [
            'linear-gradient(135deg, rgba(255, 182, 193, 0.8), rgba(255, 105, 180, 0.6))',
            'linear-gradient(135deg, rgba(135, 206, 235, 0.8), rgba(30, 144, 255, 0.6))',
            'linear-gradient(135deg, rgba(144, 238, 144, 0.8), rgba(34, 139, 34, 0.6))',
            'linear-gradient(135deg, rgba(255, 255, 153, 0.8), rgba(255, 215, 0, 0.6))',
            'linear-gradient(135deg, rgba(221, 160, 221, 0.8), rgba(138, 43, 226, 0.6))',
            'linear-gradient(135deg, rgba(255, 218, 185, 0.8), rgba(255, 140, 0, 0.6))',
            'linear-gradient(135deg, rgba(255, 192, 203, 0.8), rgba(255, 20, 147, 0.6))',
            'linear-gradient(135deg, rgba(176, 224, 230, 0.8), rgba(95, 158, 160, 0.6))'
        ];

        // URLs dos personagens
        const characterImages = {
            idle: '../src/assets/images/Mari_Idle.gif',
            victory: '../src/assets/images/Mari_Acerto.gif'
        };

        // Sistema de √°udio
        class AudioManager {
            constructor() {
                this.context = null;
                this.enabled = true;
            }

            init() {
                if (!this.context && window.AudioContext) {
                    this.context = new (window.AudioContext || window.webkitAudioContext)();
                }
            }

            playPop() {
                if (!this.enabled || !this.context) return;
                
                const oscillator = this.context.createOscillator();
                const gainNode = this.context.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(this.context.destination);
                
                oscillator.frequency.value = 800;
                oscillator.frequency.exponentialRampToValueAtTime(400, this.context.currentTime + 0.1);
                
                gainNode.gain.value = 0.3;
                gainNode.gain.exponentialRampToValueAtTime(0.01, this.context.currentTime + 0.1);
                
                oscillator.start(this.context.currentTime);
                oscillator.stop(this.context.currentTime + 0.1);
            }

            playVictory() {
                if (!this.enabled || !this.context) return;
                
                const notes = [523, 659, 784, 1047];
                notes.forEach((freq, i) => {
                    setTimeout(() => {
                        const oscillator = this.context.createOscillator();
                        const gainNode = this.context.createGain();
                        
                        oscillator.connect(gainNode);
                        gainNode.connect(this.context.destination);
                        
                        oscillator.frequency.value = freq;
                        gainNode.gain.value = 0.2;
                        gainNode.gain.exponentialRampToValueAtTime(0.01, this.context.currentTime + 0.2);
                        
                        oscillator.start(this.context.currentTime);
                        oscillator.stop(this.context.currentTime + 0.2);
                    }, i * 100);
                });
            }
        }

        const audio = new AudioManager();

        // Inicializa√ß√£o
        function init() {
            audio.init();
            loadProgress();
            setupEventListeners();
            setupCharacters();
        }

        // Configurar personagens
        function setupCharacters() {
            document.getElementById('victoryCharacter').style.backgroundImage = `url('${characterImages.victory}')`;
        }

        // Tenta pr√©-tocar o v√≠deo em background
        const heroVideo = document.getElementById('heroVideo');
        if (heroVideo) {
          heroVideo.play().catch(()=>{});
        }

        // Configurar event listeners
        function setupEventListeners() {
            // Bot√£o iniciar
            const sb = document.getElementById('startBtn');
            if (sb) sb.addEventListener('click', startGame);

            // Sele√ß√£o de dificuldade no menu
            document.querySelectorAll('.difficultyBtn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const target = e.currentTarget || e.target;
                    document.querySelectorAll('.difficultyBtn').forEach(b => b.classList.remove('selected'));
                    target.classList.add('selected');
                    gameState.level = parseInt(target.dataset.level);
                    gameState.currentRound = 1;
                    saveProgress();
                });
            });

            // Controles do jogo
            document.getElementById('menuBtnInGame').addEventListener('click', backToMenu);
            document.getElementById('soundBtn').addEventListener('click', toggleSound);
            document.getElementById('resetRoundBtn').addEventListener('click', resetRound);

            // Bot√µes de vit√≥ria
            document.getElementById('victoryMenuBtn').addEventListener('click', backToMenu);
            document.getElementById('nextActionBtn').addEventListener('click', nextAction);

            // Delega√ß√£o de eventos (fallback) caso algum bind falhe
            document.addEventListener('click', function(e){
                const nextBtn = e.target.closest?.('#nextActionBtn');
                if (nextBtn) { e.preventDefault(); nextAction(); return; }
                const menuBtn = e.target.closest?.('#victoryMenuBtn');
                if (menuBtn) { e.preventDefault(); backToMenu(); return; }
            }, true);

            // Teclado para acessibilidade
            document.addEventListener('keydown', (e) => {
                if (!gameState.isPlaying) return;
                
                if (e.key >= '0' && e.key <= '9') {
                    const num = parseInt(e.key);
                    for (let i = 0; i < num && i < gameState.bubbles.length; i++) {
                        popBubble(gameState.bubbles[i]);
                    }
                }
            });
        }

        // Fallback direto para sele√ß√£o de dificuldade, usado pelos onclick dos bot√µes
        function selectDifficulty(level) {
            document.querySelectorAll('.difficultyBtn').forEach(b => b.classList.remove('selected'));
            const btn = document.querySelector(`.difficultyBtn[data-level="${level}"]`);
            if (btn) btn.classList.add('selected');
            gameState.level = parseInt(level);
            gameState.currentRound = 1;
            saveProgress();
        }

        // Iniciar jogo
        function startGame() {
            document.getElementById('startMenu').classList.add('hidden');
            document.getElementById('gameContainer').classList.add('active');
            gameState.isPlaying = true;
            gameState.currentRound = 1;
            startNewRound();
            gameLoop();
            const heroVideo = document.getElementById('heroVideo');
            if (heroVideo) {
              heroVideo.pause();
              heroVideo.currentTime = 0;
            }
        }

        // Voltar ao menu
        function backToMenu() {
            gameState.isPlaying = false;
            gameState.currentRound = 1;
            
            // Limpar bolhas
            gameState.bubbles.forEach(bubble => bubble.element.remove());
            gameState.bubbles = [];
            
            // Esconder modais e mostrar menu
            document.getElementById('victoryModal').classList.remove('show');
            document.getElementById('gameContainer').classList.remove('active');
            document.getElementById('startMenu').classList.remove('hidden');
            const heroVideo = document.getElementById('heroVideo');
            if (heroVideo) {
              heroVideo.play().catch(()=>{});
            }
            
            // Cancelar anima√ß√£o
            if (gameState.animationId) {
                cancelAnimationFrame(gameState.animationId);
                gameState.animationId = null;
            }
        }

        // Alternar som
        function toggleSound() {
            gameState.soundEnabled = !gameState.soundEnabled;
            document.getElementById('soundBtn').textContent = gameState.soundEnabled ? 'üîä' : 'üîá';
            saveProgress();
        }

        // Resetar rodada
        function resetRound() {
            startNewRound();
        }

        // Pr√≥xima a√ß√£o (rodada ou n√≠vel)
        function nextAction() {
            document.getElementById('victoryModal').classList.remove('show');
            
            // Verificar se completou todas as rodadas do n√≠vel
            if (gameState.currentRound >= gameState.roundsPerLevel) {
                // Passou de n√≠vel
                if (gameState.level < 3) {
                    gameState.level++;
                    gameState.currentRound = 1;
                    
                    // Atualizar sele√ß√£o de dificuldade
                    document.querySelectorAll('.difficultyBtn').forEach(btn => {
                        btn.classList.toggle('selected', parseInt(btn.dataset.level) === gameState.level);
                    });
                    
                    announce(`Parab√©ns! Voc√™ avan√ßou para o n√≠vel ${levelConfig[gameState.level].name}!`);
                } else {
                    // Completou todos os n√≠veis - reinicia do 1
                    gameState.level = 1;
                    gameState.currentRound = 1;
                    announce('Incr√≠vel! Voc√™ completou todos os n√≠veis! Vamos jogar novamente!');
                }
            } else {
                // Pr√≥xima rodada do mesmo n√≠vel
                gameState.currentRound++;
            }
            
            saveProgress();
            startNewRound();
        }

        // Nova rodada
        function startNewRound() {
            const config = levelConfig[gameState.level].rounds[gameState.currentRound - 1];
            gameState.target = Math.floor(Math.random() * (config.max - config.min + 1)) + config.min;
            gameState.current = 0;
            
            // Limpar bolhas existentes
            gameState.bubbles.forEach(bubble => bubble.element.remove());
            gameState.bubbles = [];
            
            // Atualizar UI
            updateDisplay();
            updateProgressBar();
            // Garante primeira bolha 
            gameState.lastBubbleTime = 0;
            createBubble();
            
            // Anunciar para leitores de tela
            announce(`Rodada ${gameState.currentRound} de ${gameState.roundsPerLevel}. Estoure ${gameState.target} bolhas. N√≠vel ${levelConfig[gameState.level].name}`);
        }

        // Criar bolha com movimento din√¢mico
        function createBubble() {
            const config = levelConfig[gameState.level].rounds[gameState.currentRound - 1];
            const size = Math.random() * (config.size.max - config.size.min) + config.size.min;
            const speed = Math.random() * (config.speed.max - config.speed.min) + config.speed.min;
            
            const bubble = document.createElement('div');
            bubble.className = 'bubble';
            bubble.style.width = size + 'px';
            bubble.style.height = size + 'px';
            bubble.style.background = bubbleColors[Math.floor(Math.random() * bubbleColors.length)];
            bubble.style.boxShadow = `0 0 20px rgba(255, 255, 255, 0.5), inset 0 0 15px rgba(255, 255, 255, 0.3)`;
            
            // Posi√ß√£o inicial com varia√ß√£o maior
            const wandRect = document.getElementById('bubbleWand').getBoundingClientRect();
            const containerRect = document.getElementById('contentArea').getBoundingClientRect();
            
            // Variar posi√ß√£o de sa√≠da baseado no movimento
            let startXVariation = 0;
            switch(config.movement) {
                case 'slight': startXVariation = (Math.random() - 0.5) * 120; break;
                case 'moderate': startXVariation = (Math.random() - 0.5) * 180; break;
                case 'zigzag': startXVariation = (Math.random() - 0.5) * 250; break;
                case 'curved': startXVariation = (Math.random() - 0.5) * 300; break;
                case 'random': startXVariation = (Math.random() - 0.5) * 400; break;
                case 'chaotic': startXVariation = (Math.random() - 0.5) * 500; break;
                default: startXVariation = (Math.random() - 0.5) * 60;
            }
            
            const startX = (wandRect.left - containerRect.left) + wandRect.width / 2 - size / 2 + startXVariation;
            const startY = (wandRect.top - containerRect.top) - size + 100;
            
            bubble.style.left = startX + 'px';
            bubble.style.top = startY + 'px';
            
            // Adicionar ao container do jogo
            document.getElementById('gameContainer').appendChild(bubble);
            
            // Configurar movimento baseado no tipo
            let movementData = {
                type: config.movement,
                amplitude: 0,
                frequency: 0,
                phase: Math.random() * Math.PI * 2,
                direction: Math.random() > 0.5 ? 1 : -1
            };
            
            switch(config.movement) {
                case 'slight':
                    movementData.amplitude = 20 + Math.random() * 10;
                    movementData.frequency = 0.01 + Math.random() * 0.01;
                    break;
                case 'moderate':
                    movementData.amplitude = 30 + Math.random() * 20;
                    movementData.frequency = 0.02 + Math.random() * 0.01;
                    break;
                case 'zigzag':
                    movementData.amplitude = 40 + Math.random() * 30;
                    movementData.frequency = 0.03 + Math.random() * 0.02;
                    break;
                case 'curved':
                    movementData.amplitude = 50 + Math.random() * 40;
                    movementData.frequency = 0.02 + Math.random() * 0.02;
                    break;
                case 'random':
                    movementData.amplitude = 60 + Math.random() * 50;
                    movementData.frequency = 0.04 + Math.random() * 0.03;
                    movementData.changeRate = 0.02;
                    break;
                case 'chaotic':
                    movementData.amplitude = 80 + Math.random() * 60;
                    movementData.frequency = 0.05 + Math.random() * 0.04;
                    movementData.changeRate = 0.03;
                    movementData.chaos = true;
                    break;
            }
            
            // Criar objeto de bolha
            const bubbleObj = {
                element: bubble,
                x: startX,
                y: startY,
                baseX: startX,
                vy: -speed,
                size: size,
                popped: false,
                movement: movementData,
                time: 0
            };
            
            // Event listener para estourar
            bubble.addEventListener('click', () => popBubble(bubbleObj));
            bubble.addEventListener('pointerdown', (e) => {
                e.preventDefault();
                popBubble(bubbleObj);
                });
            
            gameState.bubbles.push(bubbleObj);
            
            return bubbleObj;
        }

        // Estourar bolha
        function popBubble(bubbleObj) {
            if (bubbleObj.popped || gameState.current >= gameState.target) return;
            
            bubbleObj.popped = true;
            gameState.current++;
            
            // Efeito visual de estouro
            const rect = bubbleObj.element.getBoundingClientRect();
            const containerRect = document.getElementById('contentArea').getBoundingClientRect();
            createPopEffect(
                rect.left - containerRect.left + bubbleObj.size / 2, 
                rect.top - containerRect.top + bubbleObj.size / 2
            );
            
            // Som
            if (gameState.soundEnabled && audio.context) {
                audio.playPop();
            }
            
            // Remover bolha
            bubbleObj.element.remove();
            const index = gameState.bubbles.indexOf(bubbleObj);
            if (index > -1) gameState.bubbles.splice(index, 1);
            
            // Atualizar display
            updateDisplay();
            
            // Verificar vit√≥ria
            if (gameState.current === gameState.target) {
                setTimeout(victory, 300);
            }
        }

        // Efeito de estouro
        function createPopEffect(x, y) {
            const pop = document.createElement('div');
            pop.className = 'pop';
            pop.style.left = x + 'px';
            pop.style.top = y + 'px';
            
            // Criar part√≠culas
            for (let i = 0; i < 8; i++) {
                const particle = document.createElement('div');
                particle.className = 'popParticle';
                const angle = (i / 8) * Math.PI * 2;
                const distance = 30 + Math.random() * 20;
                particle.style.setProperty('--tx', Math.cos(angle) * distance + 'px');
                particle.style.setProperty('--ty', Math.sin(angle) * distance + 'px');
                pop.appendChild(particle);
            }
            
            document.getElementById('gameContainer').appendChild(pop);
            setTimeout(() => pop.remove(), 600);
        }

        // Vit√≥ria
        function victory() {
            if (gameState.soundEnabled && audio.context) {
                audio.playVictory();
            }
            // Confete desativado para n√£o interferir com cliques no modal
            
            // Atualizar mensagem e bot√£o baseado na situa√ß√£o
            const isLastRound = gameState.currentRound >= gameState.roundsPerLevel;
            const isLastLevel = gameState.level >= 3;
            
            let title = 'üéâ Muito Bem! üéâ';
            let message = `Rodada ${gameState.currentRound} completa!`;
            let buttonText = 'Pr√≥xima Rodada';
            
            if (isLastRound) {
                if (isLastLevel) {
                    title = 'üèÜ Incr√≠vel! üèÜ';
                    message = 'Voc√™ completou todos os desafios!';
                    buttonText = 'Jogar Novamente';
                } else {
                    title = '‚≠ê Excelente! ‚≠ê';
                    message = `N√≠vel ${levelConfig[gameState.level].name} completo! Pr√≥ximo: ${levelConfig[gameState.level + 1].name}`;
                    buttonText = 'Pr√≥ximo N√≠vel';
                }
            }
            
            document.getElementById('victoryTitle').textContent = title;
            document.getElementById('victoryMessage').textContent = message;
            document.getElementById('nextActionBtn').textContent = buttonText;
            
            document.getElementById('victoryModal').classList.add('show');
            announce(message);
        }

        // Confete
        function createConfetti() {
            const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#feca57', '#ff9ff3'];
            for (let i = 0; i < 30; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + '%';
                    confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.animationDelay = Math.random() * 0.5 + 's';
                    document.getElementById('contentArea').appendChild(confetti);
                    setTimeout(() => confetti.remove(), 3000);
                }, i * 50);
            }
        }

        // Game loop com movimento din√¢mico
        function gameLoop() {
            if (!gameState.isPlaying) return;
            
            const now = Date.now();
            const config = levelConfig[gameState.level].rounds[gameState.currentRound - 1];
            
            // Criar novas bolhas
            if (now - gameState.lastBubbleTime > config.spawnRate && gameState.bubbles.length < 10) {
                createBubble();
                gameState.lastBubbleTime = now;
            }
            
            // Atualizar posi√ß√£o das bolhas com movimento
            gameState.bubbles.forEach(bubble => {
                if (!bubble.popped) {
                    bubble.time++;
                    bubble.y += bubble.vy;
                    
                    // Aplicar movimento lateral baseado no tipo
                    let deltaX = 0;
                    switch(bubble.movement.type) {
                        case 'straight':
                            // Sem movimento lateral
                            break;
                        case 'slight':
                        case 'moderate':
                            deltaX = Math.sin(bubble.time * bubble.movement.frequency + bubble.movement.phase) * 
                                    bubble.movement.amplitude * bubble.movement.direction;
                            break;
                        case 'zigzag':
                            deltaX = Math.sin(bubble.time * bubble.movement.frequency) * 
                                    bubble.movement.amplitude * bubble.movement.direction;
                            break;
                        case 'curved':
                            deltaX = Math.sin(bubble.time * bubble.movement.frequency + bubble.movement.phase) * 
                                    bubble.movement.amplitude * 
                                    (1 + Math.sin(bubble.time * 0.005)) * bubble.movement.direction;
                            break;
                        case 'random':
                            if (Math.random() < bubble.movement.changeRate) {
                                bubble.movement.direction *= -1;
                            }
                            deltaX = Math.sin(bubble.time * bubble.movement.frequency + bubble.movement.phase) * 
                                    bubble.movement.amplitude * bubble.movement.direction;
                            break;
                        case 'chaotic':
                            if (Math.random() < bubble.movement.changeRate) {
                                bubble.movement.direction *= -1;
                                bubble.movement.frequency += (Math.random() - 0.5) * 0.01;
                            }
                            deltaX = Math.sin(bubble.time * bubble.movement.frequency + bubble.movement.phase) * 
                                    bubble.movement.amplitude * bubble.movement.direction * 
                                    (1 + Math.random() * 0.5);
                            break;
                    }
                    
                    bubble.x = bubble.baseX + deltaX;
                    
                    // Aplicar transforma√ß√£o
                    bubble.element.style.transform = `translate(${bubble.x - parseFloat(bubble.element.style.left)}px, ${bubble.y - parseFloat(bubble.element.style.top)}px)`;
                    
                    // Remover bolhas que sa√≠ram da tela
                    if (bubble.y < -bubble.size - 100) {
                        bubble.element.remove();
                        const index = gameState.bubbles.indexOf(bubble);
                        if (index > -1) gameState.bubbles.splice(index, 1);
                    }
                }
            });
            
            gameState.animationId = requestAnimationFrame(gameLoop);
        }

        // Atualizar display
        function updateDisplay() {
            const levelInfo = levelConfig[gameState.level];
            document.getElementById('levelName').textContent = `N√≠vel ${levelInfo.name}`;
            document.getElementById('currentRound').textContent = gameState.currentRound;
            document.getElementById('totalRounds').textContent = gameState.roundsPerLevel;
            document.getElementById('targetNumber').textContent = gameState.target;
            document.getElementById('currentCount').textContent = gameState.current;
            document.getElementById('totalCount').textContent = gameState.target;
        }

        // Atualizar barra de progresso
        function updateProgressBar() {
            const totalProgress = ((gameState.level - 1) * gameState.roundsPerLevel + gameState.currentRound - 1) / (3 * gameState.roundsPerLevel) * 100;
            document.getElementById('progressFill').style.width = totalProgress + '%';
        }

        // Anunciar para leitores de tela
        function announce(message) {
            const announcer = document.getElementById('screenReaderAnnouncements');
            announcer.textContent = message;
        }

        // Salvar progresso
        function saveProgress() {
            const saved = {
                level: gameState.level,
                currentRound: gameState.currentRound,
                soundEnabled: gameState.soundEnabled
            };
            try {
                localStorage.setItem('bubbleGameState', JSON.stringify(saved));
            } catch(e) {
                console.log('LocalStorage n√£o dispon√≠vel');
            }
        }

        // Carregar progresso
        function loadProgress() {
            try {
                const saved = localStorage.getItem('bubbleGameState');
                if (saved) {
                    const data = JSON.parse(saved);
                    gameState.level = data.level || 1;
                    gameState.currentRound = data.currentRound || 1;
                    gameState.soundEnabled = data.soundEnabled !== false;
                    
                    // Atualizar UI
                    document.querySelectorAll('.difficultyBtn').forEach(btn => {
                        btn.classList.toggle('selected', parseInt(btn.dataset.level) === gameState.level);
                    });
                    document.getElementById('soundBtn').textContent = gameState.soundEnabled ? 'üîä' : 'üîá';
                }
            } catch (e) {
                console.error('Erro ao carregar progresso:', e);
            }
        }

        // Iniciar quando o DOM estiver pronto
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
</script>
    <script>
        (function fixMobileVH(){
            const setVH = () => {
            const vh = window.innerHeight * 0.01;
            document.documentElement.style.setProperty('--app-vh', `${vh * 100}px`);
            };
            setVH();
            window.addEventListener('resize', setVH);
            window.addEventListener('orientationchange', setVH);
        })();
        </script>

  <!-- ===========================
      Widget de Acessibilidade (c√≥pia padronizada)
      =========================== -->

  <!-- Bot√£o Flutuante de Acessibilidade -->
  <button
    class="accessibility-float-btn"
    id="accessibilityFloatBtn"
    aria-label="Abrir menu de acessibilidade"
    aria-controls="accessibilityPanel"
    aria-expanded="false"
    onclick="toggleAccessibilityPanel()"
  >
    <span class="accessibility-icon" aria-hidden="true">
      <img src="../src/assets/images/icon-acessibilidade.png" alt="">
    </span>
  </button>

  <!-- Overlay -->
  <div
    class="accessibility-panel-overlay"
    id="accessibilityOverlay"
    onclick="closeAccessibilityPanel()"
    aria-hidden="true"
  ></div>

  <!-- Painel de Acessibilidade (drawer √† direita) -->
  <div
    class="accessibility-panel-modern right-drawer"
    id="accessibilityPanel"
    role="dialog"
    aria-modal="true"
    aria-labelledby="accessibilityPanelTitle"
  >
    <div class="panel-header-modern">
      <h2 id="accessibilityPanelTitle">Menu de Acessibilidade</h2>
      <button
        class="close-btn"
        type="button"
        aria-label="Fechar menu de acessibilidade"
        onclick="closeAccessibilityPanel()"
      >
        √ó
      </button>
    </div>

    <!-- √Årea rol√°vel do painel -->
    <div class="panel-content" id="accessibilityPanelContent" tabindex="-1">
      <!-- Perfis de Acessibilidade -->
      <div class="accessibility-profiles">
        <h3>Selecione seu perfil de acessibilidade</h3>
        <div class="profiles-grid">
          <button class="profile-btn" onclick="applyProfile('motor')" data-profile="motor" type="button">
            <span class="profile-icon" aria-hidden="true">ü¶Ω</span>
            <span class="profile-text">Defici√™ncia Motora</span>
          </button>
          <button class="profile-btn" onclick="applyProfile('visual')" data-profile="visual" type="button">
            <span class="profile-icon" aria-hidden="true">üëÅÔ∏è</span>
            <span class="profile-text">Defici√™ncia Visual</span>
          </button>
          <button class="profile-btn" onclick="applyProfile('cognitive')" data-profile="cognitive" type="button">
            <span class="profile-icon" aria-hidden="true">üß†</span>
            <span class="profile-text">Defici√™ncia Cognitiva</span>
          </button>
          <button class="profile-btn" onclick="applyProfile('hearing')" data-profile="hearing" type="button">
            <span class="profile-icon" aria-hidden="true">ü¶ª</span>
            <span class="profile-text">Defici√™ncia Auditiva</span>
          </button>
        </div>
      </div>

      <!-- Ferramentas Individuais -->
      <div class="tools-grid" role="group" aria-label="Ferramentas de acessibilidade">
        <!-- Linha 1 -->
        <button class="tool-btn" onclick="toggleTextToSpeech()" id="ttsBtn" type="button">
          <span class="tool-icon" aria-hidden="true">üîä</span>
          <span class="tool-text">Clique para Ouvir</span>
        </button>

        <button class="tool-btn" onclick="toggleHighContrast()" id="contrastBtn" type="button">
          <span class="tool-icon" aria-hidden="true">üåì</span>
          <span class="tool-text">Alto Contraste</span>
        </button>

        <button class="tool-btn" onclick="toggleDarkMode()" id="darkModeBtn" type="button">
          <span class="tool-icon" aria-hidden="true">üåô</span>
          <span class="tool-text">Modo Escuro</span>
        </button>

        <!-- Linha 2 -->
        <button class="tool-btn" onclick="decreaseFontSize()" id="decreaseFontBtn" type="button">
          <span class="tool-icon" aria-hidden="true">üî§</span>
          <span class="tool-text">Diminuir Fonte</span>
        </button>

        <button class="tool-btn" onclick="increaseFontSize()" id="increaseFontBtn" type="button">
          <span class="tool-icon" aria-hidden="true">üî†</span>
          <span class="tool-text">Aumentar Fonte</span>
        </button>

        <button class="tool-btn" onclick="toggleDyslexiaFont()" id="dyslexiaBtn" type="button">
          <span class="tool-icon" aria-hidden="true">üìù</span>
          <span class="tool-text">Fonte Dislexia</span>
        </button>

        <!-- Linha 3 -->
        <button class="tool-btn" onclick="toggleGrayscale()" id="grayscaleBtn" type="button">
          <span class="tool-icon" aria-hidden="true">‚ö´</span>
          <span class="tool-text">Monocrom√°tico</span>
        </button>

        <button class="tool-btn" onclick="toggleLowSaturation()" id="lowSatBtn" type="button">
          <span class="tool-icon" aria-hidden="true">üîò</span>
          <span class="tool-text">Baixa Satura√ß√£o</span>
        </button>

        <button class="tool-btn" onclick="toggleHighSaturation()" id="highSatBtn" type="button">
          <span class="tool-icon" aria-hidden="true">üü°</span>
          <span class="tool-text">Alta Satura√ß√£o</span>
        </button>

        <!-- Linha 4 -->
        <button class="tool-btn" onclick="toggleReadingRuler()" id="rulerBtn" type="button">
          <span class="tool-icon" aria-hidden="true">üìè</span>
          <span class="tool-text">R√©gua de Leitura</span>
        </button>

        <button class="tool-btn" onclick="toggleMagnifier()" id="magnifierBtn" type="button">
          <span class="tool-icon" aria-hidden="true">üìñ</span>
          <span class="tool-text">Mascara de Leitura</span>
        </button>

        <button class="tool-btn" onclick="toggleFocusHighlight()" id="focusBtn" type="button">
          <span class="tool-icon" aria-hidden="true">üéØ</span>
          <span class="tool-text">Destacar Links</span>
        </button>

        <!-- Linha 5 -->
        <button class="tool-btn" onclick="pauseAnimations()" id="animationBtn" type="button">
          <span class="tool-icon" aria-hidden="true">‚è∏Ô∏è</span>
          <span class="tool-text">Pausar Anima√ß√µes</span>
        </button>

        <button class="tool-btn" onclick="showKeyboardShortcuts()" type="button">
          <span class="tool-icon" aria-hidden="true">‚å®Ô∏è</span>
          <span class="tool-text">Atalhos Teclado</span>
        </button>

        <!-- (VLibras removido do painel nesta p√°gina) -->

        <!-- Reset de Acessibilidade (ID diferente para n√£o conflitar com reset do jogo) -->
        <button class="tool-btn" onclick="resetAll()" id="a11yResetBtn" type="button">
          <span class="tool-icon" aria-hidden="true">üîÑ</span>
          <span class="tool-text">Resetar Tudo</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Elementos auxiliares fora do painel -->
  <div class="reading-ruler" id="readingRuler" aria-hidden="true"></div>
  <div class="magnifier-circle" id="magnifier" aria-hidden="true"></div>

  <!-- VLibras removido nesta p√°gina -->

  <!-- Desativa VLibras s√≥ nesta p√°gina: evita inje√ß√£o autom√°tica pelo painel -->
  <script>
    try {
      const raw = localStorage.getItem('a11ySettings');
      const s = raw ? JSON.parse(raw) : {};
      s.vlibrasEnabled = false;
      s.timestamp = Date.now();
      localStorage.setItem('a11ySettings', JSON.stringify(s));
      // limpa qualquer flag de carregamento residual
      window.__vlibrasLoaded = false;
    } catch (e) {}
  </script>

  <!-- Script do painel -->
  <script src="../src/js/acessibilidade.js" defer></script>

  <!-- Sem ajustes de VLibras nesta p√°gina -->

</body>
</html>
