
<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Soletra Diário</title>
  <style>
    /*=== VARIÁVEIS DE ESTILO (TEMA CLARO) ===*/
    :root {
      --primary-color: #667eea;
      --secondary-color: #764ba2;
      --accent-color: #f59e0b; /* Amarelo/Laranja para destaque */
      --success-color: #16a34a;
      --error-color: #dc2626;
      --text-dark: #1f2937;
      --text-light: #f9fafb;
      --bg-light: #f3f4f6;
      --bg-white: #ffffff;
      --radius: 12px;
      --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    /*=== BASE E FUNDO ===*/
    *, *::before, *::after {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html {
      font-size: 100%;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: linear-gradient(135deg, #6c63ff 0%, #7c4dff 35%, #9c27b0 70%, #673ab7 100%);
      color: var(--text-dark);
      line-height: 1.6;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1rem;
      overflow-x: hidden;
    }

    /*=== CONTAINER PRINCIPAL DO JOGO ===*/
    .game-wrapper {
      width: 100%;
      max-width: 1000px;
      display: flex;
      gap: 2rem;
      background: var(--bg-white);
      border-radius: var(--radius);
      padding: 2rem;
      border: 1px solid #e5e7eb;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.05);
      color: var(--text-dark);
      position: relative;
    }

    .game-main {
      flex: 1.7;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      transform: translateX(-10px);
    }

    .sidebar-container {
      flex: 1.4;
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .game-sidebar {
      flex: 1;
      background: var(--bg-light);
      border-radius: var(--radius);
      padding: 1.1rem;
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    /*=== ÁREA DE JOGO (MAIN) ===*/
    .word-display-container {
        width: 100%;
        text-align: center;
        margin-bottom: 0.3rem;
    }
    
    .word-display {
        min-height: 48px;
        font-size: 2rem;
        font-weight: 700;
        letter-spacing: 2px;
        text-transform: uppercase;
        border-bottom: 2px solid var(--accent-color);
        display: inline-block;
        padding: 0 0.5rem;
        color: var(--text-dark);
    }

    .feedback-message {
        height: 24px;
        margin-bottom: 1rem;
        font-weight: 600;
        font-size: 1rem;
        text-align: center;
        transition: opacity 0.3s ease;
    }

    .letter-container {
      position: relative;
      width: clamp(220px, 55vw, 340px);
      height: clamp(220px, 55vw, 340px);
      margin: 1rem auto;
    }

    .letter-btn {
      width: clamp(56px, 14vw, 84px);
      height: clamp(56px, 14vw, 84px);
      border-radius: 50%;
      border: 2px solid #d1d5db;
      background: var(--bg-white);
      color: var(--text-dark);
      font-size: clamp(1.8rem, 5vw, 2.6rem);
      font-weight: bold;
      cursor: pointer;
      transition: var(--transition);
      display: flex;
      align-items: center;
      justify-content: center;
      position: absolute;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }

    .letter-btn:hover {
      background: #f9fafb;
      transform: scale(1.05);
      border-color: #9ca3af;
    }
    
    .letter-btn.central {
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: var(--accent-color);
      border-color: var(--accent-color);
      color: var(--text-dark);
    }
     .letter-btn.central:hover {
      background: #fbbf24;
      transform: translate(-50%, -50%) scale(1.05);
    }

    .action-buttons {
      display: flex;
      gap: 1rem;
      margin-top: 1rem;
      justify-content: center;
      flex-wrap: wrap;
      width: 100%;
    }

    .end-game-wrapper {
      width: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.5rem;
    }

    .end-game-warning {
      min-height: 1rem;
      font-size: 0.9rem;
      color: var(--error-color);
      text-align: center;
    }

    .end-game-actions {
      display: flex;
      gap: 0.75rem;
      justify-content: center;
      flex-wrap: wrap;
      align-items: center;
    }

    .game-btn {
      padding: 12px 25px;
      border: 1px solid #d1d5db;
      border-radius: 30px;
      font-weight: 600;
      transition: var(--transition);
      cursor: pointer;
      background: var(--bg-white);
      color: var(--text-dark);
      font-size: 1rem;
    }

    .game-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      border-color: #9ca3af;
    }

    .game-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        background: #e5e7eb;
    }

    .game-btn.primary {
      background: #7c3aed;
      color: white;
      border-color: #7c3aed;
    }
    .game-btn.primary:hover {
        background: #6d28d9;
        border-color: #6d28d9;
    }

    .game-btn.end {
      background: var(--secondary-color);
      color: white;
      border-color: var(--secondary-color);
    }
    .game-btn.end:hover {
      background: #5b36a8;
      border-color: #5b36a8;
    }

    .icon-btn {
      width: 44px;
      height: 44px;
      border-radius: 50%;
      border: none;
      background: rgba(118,75,162,0.15);
      color: var(--secondary-color);
      font-size: 1.35rem;
      font-weight: 700;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(0,0,0,0.12);
      transition: transform 0.2s ease, box-shadow 0.2s ease, background 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .icon-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(0,0,0,0.18);
      background: rgba(118,75,162,0.25);
    }

    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(15, 23, 42, 0.65);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: max(12px, env(safe-area-inset-top, 12px)) max(16px, env(safe-area-inset-right, 16px)) max(12px, env(safe-area-inset-bottom, 12px)) max(16px, env(safe-area-inset-left, 16px));
      z-index: 100;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.35s ease, visibility 0.35s ease;
    }

    .modal-backdrop.active {
      opacity: 1;
      visibility: visible;
    }

    .modal-content {
      width: min(92%, 600px);
      background: linear-gradient(145deg, #ffffff 0%, #f8fafc 100%);
      border-radius: 18px;
      padding: 2rem 2rem 2.25rem;
      box-shadow: 0 22px 48px rgba(15, 23, 42, 0.25);
      position: relative;
      color: var(--text-dark);
      transform: translateY(24px) scale(0.96);
      transition: transform 0.35s ease, opacity 0.35s ease;
      opacity: 0;
      max-height: min(88vh, 720px);
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
    }

    .modal-backdrop.active .modal-content {
      transform: translateY(0) scale(1);
      opacity: 1;
    }

    .modal-close {
      position: absolute;
      top: 1rem;
      right: 1rem;
      background: rgba(148, 163, 184, 0.2);
      border: none;
      font-size: 1.75rem;
      color: #475569;
      cursor: pointer;
      line-height: 1;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.2s ease, color 0.2s ease, transform 0.2s ease;
    }

    .modal-close:hover {
      color: var(--secondary-color);
      background: rgba(118, 75, 162, 0.12);
      transform: scale(1.05);
    }

    .modal-header {
      text-align: center;
      margin-bottom: 1.5rem;
    }

    .modal-header h2 {
      font-size: 1.9rem;
      font-weight: 700;
      margin-bottom: 0.35rem;
      color: var(--secondary-color);
    }

    .modal-header .modal-subtitle {
      font-size: 1rem;
      color: #4b5563;
      max-width: 460px;
      margin: 0 auto;
    }

    .modal-section {
      background: #f8fafc;
      border-radius: 14px;
      padding: 1.1rem 1.25rem;
      margin-bottom: 1rem;
      border: 1px solid rgba(148, 163, 184, 0.25);
    }

    .modal-section h3 {
      font-size: 1.15rem;
      font-weight: 700;
      margin-bottom: 0.75rem;
      color: #1f2937;
    }

    .modal-list {
      list-style: none;
      padding: 0;
      margin: 0;
      display: grid;
      gap: 0.55rem;
    }

    .modal-list li {
      display: flex;
      gap: 0.5rem;
      align-items: flex-start;
      font-size: 0.98rem;
      color: #1f2937;
    }

    .modal-list li::before {
      content: '•';
      color: var(--secondary-color);
      font-weight: 700;
      margin-top: 0.15rem;
    }

    .modal-list span {
      flex: 1;
    }

    .modal-highlight {
      padding: 1.1rem 1.25rem;
      background: linear-gradient(135deg, rgba(118, 75, 162, 0.12), rgba(102, 126, 234, 0.12));
      border-radius: 14px;
      border: 1px solid rgba(118, 75, 162, 0.25);
      color: #4338ca;
      margin-bottom: 1.2rem;
    }

    .modal-highlight strong {
      display: block;
      font-size: 1.05rem;
      margin-bottom: 0.4rem;
      color: #312e81;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .stat-card {
      background: #f8fafc;
      border-radius: 12px;
      border: 1px solid rgba(148, 163, 184, 0.25);
      padding: 1rem 1.25rem;
      display: grid;
      gap: 0.35rem;
    }

    .stat-label {
      font-size: 0.85rem;
      color: #64748b;
      text-transform: uppercase;
      letter-spacing: 0.04em;
      font-weight: 600;
    }

    .stat-value {
      font-size: 1.85rem;
      font-weight: 700;
      color: var(--secondary-color);
    }

    .recent-section h3 {
      margin: 0 0 0.75rem;
      font-size: 1.1rem;
    }

    .recent-games {
      list-style: none;
      margin: 0;
      padding: 0;
      display: grid;
      gap: 0.75rem;
    }

    .recent-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
      background: #f8fafc;
      border-radius: 12px;
      border: 1px solid rgba(148, 163, 184, 0.25);
      padding: 0.75rem 1rem;
    }

    .recent-letter {
      width: 40px;
      height: 40px;
      border-radius: 999px;
      background: rgba(124, 58, 237, 0.12);
      color: var(--secondary-color);
      font-weight: 700;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .recent-body {
      flex: 1;
      display: grid;
      gap: 0.25rem;
    }

    .recent-date {
      font-size: 0.85rem;
      color: #64748b;
    }

    .recent-status {
      font-weight: 600;
      font-size: 0.95rem;
    }

    .badge {
      display: inline-block;
      padding: 0.25rem 0.6rem;
      border-radius: 999px;
      background: rgba(16, 185, 129, 0.18);
      color: #047857;
      font-size: 0.85rem;
    }

    .recent-meta {
      text-align: right;
      font-size: 0.85rem;
      color: #475569;
      display: grid;
      gap: 0.3rem;
    }

    .recent-empty {
      color: #94a3b8;
      font-style: italic;
    }

    .modal-actions {
      display: flex;
      justify-content: center;
      margin-top: 1.25rem;
    }

    .modal-action-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      padding: 0.95rem 2.5rem;
      border-radius: 999px;
      border: none;
      background: linear-gradient(135deg, #7c3aed 0%, #6366f1 100%);
      color: #fff;
      font-weight: 700;
      font-size: 1rem;
      cursor: pointer;
      box-shadow: 0 12px 24px rgba(124, 58, 237, 0.25);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .modal-action-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 16px 32px rgba(99, 102, 241, 0.3);
    }

    .modal-action-btn.secondary {
      background: #1f2937;
      box-shadow: 0 12px 22px rgba(17, 24, 39, 0.25);
    }

    .modal-action-btn.secondary:hover {
      box-shadow: 0 16px 28px rgba(17, 24, 39, 0.28);
    }

    @media (max-width: 540px) {
      .modal-content {
        padding: 1.75rem 1.25rem 2rem;
        max-height: 90vh;
      }
      .modal-action-btn {
        width: 100%;
      }
      .modal-header h2 {
        font-size: 1.6rem;
      }
      .modal-header .modal-subtitle {
        font-size: 0.9rem;
      }
      .modal-section {
        padding: 1rem 1.1rem;
      }
    }

    /*=== PAINEL LATERAL (SIDEBAR) ===*/
    .progress-section h3, .found-words-section h3 {
      margin-bottom: 0.75rem;
      font-size: 1.2rem;
      border-bottom: 1px solid #d1d5db;
      padding-bottom: 0.5rem;
    }

    .progress-bar-container {
      width: 100%;
      height: 12px;
      background: #e5e7eb;
      border-radius: 6px;
      overflow: hidden;
      margin-bottom: 0.5rem;
    }

    .progress-bar {
      width: 0%;
      height: 100%;
      background: var(--accent-color);
      border-radius: 6px;
      transition: width 0.5s ease;
    }

    .progress-text {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-weight: 500;
      font-size: 0.95rem;
      color: var(--text-dark);
    }
    
    #qualification-text {
        font-weight: 700;
        color: var(--accent-color);
    }

    .found-words-list {
      list-style: none;
      overflow-y: auto;
      flex-grow: 1;
      padding-right: 6px;
      max-height: 280px;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 0.75rem;
    }

    .found-words-list li {
      padding: 8px 12px;
      border-radius: 6px;
      font-size: 1rem;
      font-weight: 600;
      text-transform: uppercase;
      transition: all 0.3s ease;
      text-align: center;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .found-words-list li.placeholder {
      background: transparent;
      border: 2px dashed #d1d5db;
      color: #9ca3af;
    }

    .found-words-list li.placeholder.hinted {
      color: var(--accent-color);
      border-color: var(--accent-color);
      border-style: solid;
      font-weight: 700;
    }
    
    .found-words-list li.found {
      background: #dcfce7;
      border-color: transparent;
      color: #15803d;
    }
    
    .found-words-list li.revealed {
      background: #fef3c7;
      border-color: transparent;
      color: #b45309;
    }
    
    /* Custom scrollbar */
    .found-words-list::-webkit-scrollbar {
      width: 6px;
    }
    .found-words-list::-webkit-scrollbar-track {
      background: #e5e7eb;
      border-radius: 3px;
    }
    .found-words-list::-webkit-scrollbar-thumb {
      background: #9ca3af;
      border-radius: 3px;
    }
     .found-words-list::-webkit-scrollbar-thumb:hover {
      background: #6b7280;
    }

    @media (max-width: 1024px) {
      .game-wrapper {
        gap: 1.35rem;
        padding: 2rem 1.5rem;
      }
      .game-main, .sidebar-container {
        flex: 1 1 50%;
      }
      .letter-container {
        width: clamp(240px, 50vw, 320px);
        height: clamp(240px, 50vw, 320px);
      }
    }

    /*=== RESPONSIVIDADE ===*/
    @media (max-width: 640px) {
      body {
        padding: 0;
        align-items: flex-start;
      }
      .game-wrapper {
        flex-direction: column;
        border-radius: 0;
        padding: 1.5rem 1rem;
        min-height: 100vh;
      }
      .game-main {
        transform: none;
      }
      .game-sidebar {
        order: -1; /* Move a sidebar para cima */
      }
      .letter-container {
        width: clamp(200px, 70vw, 260px);
        height: clamp(200px, 70vw, 260px);
      }
      .letter-btn {
        width: clamp(52px, 18vw, 70px);
        height: clamp(52px, 18vw, 70px);
        font-size: clamp(1.6rem, 8vw, 2.1rem);
      }
      .word-display {
        font-size: 1.8rem;
      }
      .progress-text {
        flex-direction: column;
        gap: 0.25rem;
        text-align: center;
      }
      .found-words-list {
        max-height: 150px; /* Altura menor no mobile */
        grid-template-columns: 1fr;
        gap: 0.5rem;
      }
      .sidebar-container {
        order: -1;
        gap: 1rem;
      }
      .action-buttons {
        justify-content: center;
      }
      .icon-btn {
        width: 38px;
        height: 38px;
        font-size: 1.2rem;
      }
    }

    @media (max-width: 600px) {
      .modal-backdrop {
        align-items: center;
        justify-content: center;
        padding: max(1.2rem, env(safe-area-inset-top, 0.9rem))
                 max(1rem, env(safe-area-inset-right, 0.9rem))
                 max(1.1rem, env(safe-area-inset-bottom, 0.9rem))
                 max(1rem, env(safe-area-inset-left, 0.9rem));
        overflow-y: auto;
      }
      .modal-content {
        width: min(94vw, 420px);
        max-height: calc(90vh - max(2rem, env(safe-area-inset-top, 1rem)) - max(1.2rem, env(safe-area-inset-bottom, 1rem)));
        padding: 1.35rem 1.1rem 1.6rem;
        transform: none;
      }
      .modal-backdrop.active .modal-content {
        transform: none;
      }
      .modal-close {
        top: 0.75rem;
        right: 0.95rem;
        width: 32px;
        height: 32px;
        font-size: 1.3rem;
      }
      .modal-action-btn {
        width: 100%;
        padding: 0.9rem 1.2rem;
      }
      @supports (height: 100dvh) {
        .modal-backdrop {
          min-height: 100dvh;
        }
        .modal-content {
          max-height: calc(100dvh - max(2rem, env(safe-area-inset-top, 1rem)) - max(1.2rem, env(safe-area-inset-bottom, 1rem)));
        }
      }
    }

  </style>
</head>
<body>

  <div class="game-wrapper">
    <main class="game-main">
        <div class="word-display-container">
            <span id="word-display" class="word-display"></span>
        </div>
        <div id="feedback-message" class="feedback-message"></div>
        <div id="letter-container" class="letter-container">
            <!-- Letras serão inseridas pelo JS -->
        </div>
        <div class="action-buttons">
            <button id="hint-btn" class="game-btn" title="Pedir Dica">&#128161; (<span id="hint-count">10</span>)</button>
            <button id="delete-btn" class="game-btn">Apagar</button>
            <button id="shuffle-btn" class="game-btn" style="font-size: 1.5rem; line-height: 1;">&#x21BB;</button>
            <button id="confirm-btn" class="game-btn primary">Confirmar</button>
        </div>
    </main>
    <div class="sidebar-container">
        <aside class="game-sidebar">
            <div class="progress-section">
                <h3>Progresso</h3>
                <div id="qualification-text">Iniciante</div>
                <div class="progress-bar-container">
                    <div id="progress-bar" class="progress-bar"></div>
                </div>
                <div class="progress-text">
                    <span><span id="words-found-count">0</span> de <span id="total-words-count">0</span> palavras</span>
                    <span>Pontos: <span id="score-count">0</span></span>
                </div>
            </div>
            <div class="found-words-section">
                <h3>Palavras Encontradas</h3>
                <ul id="found-words-list" class="found-words-list">
                    <!-- Palavras encontradas serão inseridas aqui -->
                </ul>
            </div>
        </aside>
        <div class="end-game-wrapper">
            <div id="end-game-warning" class="end-game-warning"></div>
            <div class="end-game-actions">
                <button id="end-game-btn" class="game-btn end">Encerrar Partida</button>
                <button id="help-btn" class="icon-btn" title="Como jogar" aria-label="Como jogar">?</button>
                <button id="stats-btn" class="icon-btn" title="Estatísticas" aria-label="Estatísticas">📊</button>
                <button id="credits-btn" class="icon-btn" title="Créditos" aria-label="Créditos">&#8505;</button>
            </div>
        </div>
    </div>
  </div>

  <div id="info-modal" class="modal-backdrop" aria-hidden="true">
    <div class="modal-content" role="dialog" aria-modal="true" aria-labelledby="modal-title">
      <button class="modal-close" id="modal-close-btn" aria-label="Fechar">&times;</button>
      <div id="modal-body"></div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const jogosDataUrl = '../data/soletra_jogos.json';
      let jogosDiarios = [];





      const wordDisplay = document.getElementById('word-display');
      const feedbackMessage = document.getElementById('feedback-message');
      const letterContainer = document.getElementById('letter-container');
      const deleteBtn = document.getElementById('delete-btn');
      const shuffleBtn = document.getElementById('shuffle-btn');
      const confirmBtn = document.getElementById('confirm-btn');
      const hintBtn = document.getElementById('hint-btn');
      const hintCountSpan = document.getElementById('hint-count');
      const endGameBtn = document.getElementById('end-game-btn');
      const endGameWarning = document.getElementById('end-game-warning');
      const helpBtn = document.getElementById('help-btn');
      const statsBtn = document.getElementById('stats-btn');
      const creditsBtn = document.getElementById('credits-btn');
      const infoModal = document.getElementById('info-modal');
      const modalBody = document.getElementById('modal-body');
      const modalCloseBtn = document.getElementById('modal-close-btn');
      const progressBar = document.getElementById('progress-bar');
      const qualificationText = document.getElementById('qualification-text');
      const wordsFoundCount = document.getElementById('words-found-count');
      const totalWordsCount = document.getElementById('total-words-count');
      const foundWordsList = document.getElementById('found-words-list');
      const scoreCount = document.getElementById('score-count');

      const END_GAME_THRESHOLD = 75;
      const STORAGE_PREFIX = 'soletra-diario-estado-';
      const RECENT_GAMES_LIMIT = 7;

      let currentGame;
      let currentWord = '';
      let foundWords = [];
      let wordPlaceholders = new Map();
      let hintCount = 10;
      let score = 0;
      let gameEnded = false;
      let placeholderOverrides = new Map();
      let storageKey = '';
      let elapsedMsBase = 0;
      let sessionStartTime = null;

      function getTodayDateString() {
        const today = new Date();
        const year = today.getFullYear();
        const month = String(today.getMonth() + 1).padStart(2, '0');
        const day = String(today.getDate()).padStart(2, '0');
        return `${year}-${month}-${day}`;
      }

      function showFeedback(message, type = 'info') {
        feedbackMessage.textContent = message;
        feedbackMessage.style.color = type === 'error' ? 'var(--error-color)' : type === 'success' ? 'var(--success-color)' : 'var(--text-dark)';
        feedbackMessage.style.opacity = 1;
        setTimeout(() => {
            feedbackMessage.style.opacity = 0;
        }, 2000);
      }

      const stripDiacritics = (value) => (
        typeof value === 'string' && value.normalize
          ? value.normalize('NFD').replace(/[\u0300-\u036f]/g, '')
          : String(value || '')
      );

      const normalizeLetters = (letters) => {
        if (!Array.isArray(letters)) return [];
        const sanitized = letters
          .map((letter) => stripDiacritics(String(letter || '')).trim().toUpperCase())
          .filter(Boolean);
        return Array.from(new Set(sanitized));
      };

      const normalizeWord = (word) => {
        const trimmed = String(word || '').trim();
        if (!trimmed) return '';
        return stripDiacritics(trimmed).toLowerCase();
      };

      const sanitizeGame = (game) => {
        if (!game || typeof game !== 'object') {
          return null;
        }
        const data = typeof game.data === 'string' ? game.data.trim() : '';
        const letras = normalizeLetters(game.letras);
        const central = stripDiacritics(String(game.central || '')).trim().toUpperCase();

        if (central && !letras.includes(central)) {
          letras.push(central);
        }

        const palavras = Array.isArray(game.palavras)
          ? Array.from(new Set(
              game.palavras
                .map((palavra) => normalizeWord(palavra))
                .filter(Boolean),
            ))
          : [];

        return {
          ...game,
          data,
          letras,
          central,
          palavras,
        };
      };

      function openModal(type) {
        renderModalContent(type);
        infoModal.classList.add('active');
        infoModal.setAttribute('aria-hidden', 'false');
        const focusTarget = modalBody.querySelector('[data-modal-action]') || modalCloseBtn;
        focusTarget.focus();
        document.body.style.overflow = 'hidden';
      }

      function closeModal() {
        infoModal.classList.remove('active');
        infoModal.setAttribute('aria-hidden', 'true');
        modalBody.innerHTML = '';
        document.body.style.overflow = '';
      }

      async function loadJogos() {
        try {
          const response = await fetch(jogosDataUrl, { cache: 'no-store' });
          if (!response.ok) {
            throw new Error(`HTTP ${response.status}`);
          }
          const payload = await response.json();
          const lista = Array.isArray(payload) ? payload : payload?.jogos;
          if (!Array.isArray(lista)) {
            throw new Error('Formato de dados inválido.');
          }
          jogosDiarios = lista
            .map((item) => sanitizeGame(item))
            .filter((game) => game && Array.isArray(game.letras) && game.letras.length === 7 && game.central && Array.isArray(game.palavras) && game.palavras.length);
          initGame();
        } catch (error) {
          console.error('Erro ao carregar jogos do Soletra:', error);
          const wrapper = document.querySelector('.game-wrapper');
          if (wrapper) {
            wrapper.innerHTML = '<h1>Não foi possível carregar os jogos de hoje.</h1>';
          }
        }
      }

      const getElapsedMs = () => elapsedMsBase + (sessionStartTime ? Date.now() - sessionStartTime : 0);

      const numberFormatter = new Intl.NumberFormat('pt-BR', {
        maximumFractionDigits: 1,
        minimumFractionDigits: 0,
      });

      const integerFormatter = new Intl.NumberFormat('pt-BR');

      const formatDuration = (ms) => {
        if (!ms || ms <= 0) return '--:--';
        const totalSeconds = Math.round(ms / 1000);
        const minutes = Math.floor(totalSeconds / 60);
        const seconds = totalSeconds % 60;
        return `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
      };

      const getISODateString = (date) => {
        const year = date.getFullYear();
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const day = String(date.getDate()).padStart(2, '0');
        return `${year}-${month}-${day}`;
      };

      const getWeekdayLetter = (dateStr) => {
        const letters = ['D', 'S', 'T', 'Q', 'Q', 'S', 'S'];
        const date = new Date(`${dateStr}T00:00:00`);
        if (Number.isNaN(date.getTime())) return '-';
        return letters[date.getDay()] || '-';
      };

      const formatDateShort = (dateStr) => {
        const [year, month, day] = dateStr.split('-');
        if (!year || !month || !day) return dateStr;
        return `${day}/${month}`;
      };

      const getQualificationLabel = (percentage) => {
        if (percentage >= 100) return 'Genial!';
        if (percentage >= 80) return 'Fantástico!';
        if (percentage >= 60) return 'Excelente!';
        if (percentage >= 40) return 'Muito Bom!';
        if (percentage >= 20) return 'Bom Trabalho!';
        if (percentage > 0) return 'Continue Assim!';
        return 'Não jogado';
      };

      function calculateStats() {
        const stats = {
          gamesPlayed: 0,
          totalWords: 0,
          totalScore: 0,
          totalTimeMs: 0,
          gamesWithTime: 0,
          recent: [],
        };

        const stateByDate = new Map();

        for (let i = 0; i < localStorage.length; i += 1) {
          const key = localStorage.key(i);
          if (!key || !key.startsWith(STORAGE_PREFIX)) continue;
          try {
            const state = JSON.parse(localStorage.getItem(key));
            if (!state) continue;
            const date = key.slice(STORAGE_PREFIX.length);
            stateByDate.set(date, state);

            const foundCount = Array.isArray(state.foundWords) ? state.foundWords.length : 0;
            const played = state.gameEnded || foundCount > 0 || (state.score && state.score > 0);

            if (played) {
              stats.gamesPlayed += 1;
              stats.totalWords += foundCount;
              stats.totalScore += Number(state.score) || 0;
              if (typeof state.elapsedMs === 'number' && state.elapsedMs > 0) {
                stats.totalTimeMs += state.elapsedMs;
                stats.gamesWithTime += 1;
              }
            }
          } catch (error) {
            console.warn('Não foi possível interpretar estado salvo:', error);
          }
        }

        const today = new Date();
        today.setHours(12, 0, 0, 0);
        const gameByDate = new Map(jogosDiarios.map((game) => [game.data, game]));
        stats.recent = [];

        for (let offset = 1; offset <= RECENT_GAMES_LIMIT; offset += 1) {
          const target = new Date(today);
          target.setDate(today.getDate() - offset);
          const isoDate = getISODateString(target);
          const game = gameByDate.get(isoDate);
          const state = stateByDate.get(isoDate);
          const total = game && Array.isArray(game.palavras) ? game.palavras.length : 0;
          const found = state && Array.isArray(state.foundWords) ? state.foundWords.length : 0;
          const percentage = total > 0 ? (found / total) * 100 : 0;
          const status = found > 0 ? getQualificationLabel(percentage) : 'Não jogado';
          const score = state && typeof state.score === 'number' ? state.score : 0;

          stats.recent.push({
            date: isoDate,
            central: game && game.central ? game.central.toUpperCase() : '',
            status,
            found,
            total,
            score,
            percentage,
          });
        }

        stats.avgWords = stats.gamesPlayed ? stats.totalWords / stats.gamesPlayed : 0;
        stats.avgScore = stats.gamesPlayed ? stats.totalScore / stats.gamesPlayed : 0;
        stats.avgTimeMs = stats.gamesWithTime ? stats.totalTimeMs / stats.gamesWithTime : 0;

        return stats;
      }

      function generateStatsMarkup() {
        if (!jogosDiarios.length) {
          return `
            <div class="modal-header">
              <h2 id="modal-title">Estatísticas</h2>
            </div>
            <p style="margin:0;">Carregue os jogos para visualizar as estatísticas.</p>
          `;
        }

        const stats = calculateStats();
        const jogosValor = integerFormatter.format(stats.gamesPlayed);
        const mediaPalavras = stats.gamesPlayed ? numberFormatter.format(stats.avgWords) : '0';
        const mediaPontos = stats.gamesPlayed ? numberFormatter.format(stats.avgScore) : '0';
        const mediaTempo = formatDuration(stats.avgTimeMs);

        const recentItems = stats.recent.length
          ? stats.recent.map((item) => {
              const statusHtml = item.status === 'Não jogado'
                ? `<span class="recent-status">${item.status}</span>`
                : `<span class="badge">${item.status}</span>`;
              const progressText = item.total > 0
                ? `${item.found}/${item.total} palavras`
                : '--/--';
              const scoreText = item.total > 0
                ? `${integerFormatter.format(item.score || 0)} pts`
                : '--';
              return `
                <li class="recent-item">
                  <div class="recent-letter">${getWeekdayLetter(item.date)}</div>
                  <div class="recent-body">
                    <div class="recent-date">${formatDateShort(item.date)}</div>
                    ${statusHtml}
                  </div>
                  <div class="recent-meta">
                    <span class="recent-progress">${progressText}</span>
                    <span class="recent-score">${scoreText}</span>
                  </div>
                </li>
              `;
            }).join('')
          : '<li class="recent-empty">Nenhum histórico registrado.</li>';

        return `
          <div class="modal-header">
            <h2 id="modal-title">Estatísticas</h2>
          </div>
          <div class="stats-grid">
            <div class="stat-card">
              <span class="stat-label">Jogos</span>
              <span class="stat-value">${jogosValor}</span>
            </div>
            <div class="stat-card">
              <span class="stat-label">Média de palavras</span>
              <span class="stat-value">${mediaPalavras}</span>
            </div>
            <div class="stat-card">
              <span class="stat-label">Média de pontos</span>
              <span class="stat-value">${mediaPontos}</span>
            </div>
            <div class="stat-card">
              <span class="stat-label">Média de tempo</span>
              <span class="stat-value">${mediaTempo}</span>
            </div>
          </div>
          <div class="recent-section">
            <h3>Últimos jogos</h3>
            <ul class="recent-games">
              ${recentItems}
            </ul>
          </div>
        `;
      }

      function renderModalContent(type) {
        let template = '';

        if (type === 'tutorial') {
          template = `
            <div class="modal-header">
              <h2 id="modal-title">Como jogar Palavreando</h2>
              <p class="modal-subtitle">Descubra o máximo de palavras usando as letras do dia e faça a sua melhor pontuação!</p>
            </div>
            <div class="modal-section">
              <h3>Passo a passo</h3>
              <ul class="modal-list">
                <li><span><strong>Monte</strong> palavras com no mínimo 4 letras, sempre incluindo a letra central.</span></li>
                <li><span><strong>Embaralhe</strong> as letras para enxergar novas combinações.</span></li>
                <li><span><strong>Confirme</strong> para validar e conquistar pontos equivalentes ao tamanho da palavra.</span></li>
              </ul>
            </div>
            <div class="modal-section">
              <h3>Controles úteis</h3>
              <ul class="modal-list">
                <li><span><strong>Teclado</strong>: digite diretamente ou use Enter para confirmar.</span></li>
                <li><span><strong>Backspace</strong>: remove a última letra digitada.</span></li>
                <li><span><strong>Dicas</strong>: revele letras estratégicas quando ficar preso (limitadas!).</span></li>
              </ul>
            </div>
            <div class="modal-highlight">
              <strong>Dica de ouro</strong>
              <p>Palavras mais longas rendem mais pontos. Observe o padrão das letras externas para formar combinações maiores.</p>
            </div>
            <div class="modal-actions">
              <button class="modal-action-btn" data-modal-action="primary">Entendi, vamos jogar!</button>
            </div>
          `;
        } else if (type === 'credits') {
          template = `
            <div class="modal-header">
              <h2 id="modal-title">Créditos</h2>
            </div>
            <div class="modal-section">
              <h3>Sobre</h3>
              <p class="modal-subtitle">Palavreando é um desafio de vocabulário em que você forma palavras usando as letras do dia.</p>
              <ul class="modal-list">
                <li><span><strong>Concepção &amp; Desenvolvimento:</strong> João Jr e Ana Paula Camara</span></li>
              </ul>
            </div>
            <div class="modal-actions">
              <button class="modal-action-btn secondary" data-modal-action="secondary">Fechar</button>
            </div>
          `;
        } else if (type === 'stats') {
          template = generateStatsMarkup();
        }

        modalBody.innerHTML = template;
        modalBody.querySelectorAll('[data-modal-action]').forEach(btn => {
          btn.addEventListener('click', closeModal);
        });
        const modalContentEl = modalBody.closest('.modal-content');
        if (modalContentEl) {
          modalContentEl.scrollTop = 0;
        }
      }

      function initGame() {
        const todayDate = getTodayDateString();
        currentGame = jogosDiarios.find(jogo => jogo.data === todayDate);

        if (!currentGame) {
          document.querySelector('.game-wrapper').innerHTML = '<h1>Nenhum jogo para hoje. Volte amanhã!</h1>';
          return;
        }

        storageKey = `${STORAGE_PREFIX}${currentGame.data}`;
        placeholderOverrides.clear();
        
        foundWords = [];
        wordPlaceholders.clear();
        hintCount = 10;
        score = 0;
        gameEnded = false;
        elapsedMsBase = 0;
        sessionStartTime = Date.now();
        scoreCount.textContent = score;
        hintCountSpan.textContent = hintCount;
        hintBtn.disabled = false;
        endGameWarning.textContent = '';
        endGameBtn.disabled = false;
        confirmBtn.disabled = false;
        deleteBtn.disabled = false;
        shuffleBtn.disabled = false;
        wordDisplay.textContent = '';

        renderLetters();
        renderWordPlaceholders();
        totalWordsCount.textContent = currentGame.palavras.length;

        const savedState = loadGameState();
        if (savedState) {
          if (Array.isArray(savedState.foundWords)) {
            foundWords = [...savedState.foundWords];
            foundWords.forEach(word => revealFoundWord(word, { scroll: false }));
          }
          if (typeof savedState.score === 'number') {
            score = savedState.score;
            scoreCount.textContent = score;
          }
          if (typeof savedState.hintCount === 'number') {
            hintCount = savedState.hintCount;
            hintCountSpan.textContent = hintCount;
          }
          if (Array.isArray(savedState.placeholderOverrides)) {
            placeholderOverrides = new Map(savedState.placeholderOverrides);
          }
          const savedGameEnded = !!savedState.gameEnded;
          if (typeof savedState.elapsedMs === 'number') {
            elapsedMsBase = savedState.elapsedMs;
            sessionStartTime = savedGameEnded ? null : Date.now();
          }
          gameEnded = savedGameEnded;

          if (gameEnded) {
            revealAllWords();
            disableLetterButtons();
            confirmBtn.disabled = true;
            shuffleBtn.disabled = true;
            hintBtn.disabled = true;
            deleteBtn.disabled = true;
            endGameBtn.disabled = true;
            placeholderOverrides.clear();
            sessionStartTime = null;
          } else {
            applyPlaceholderOverrides();
            hintBtn.disabled = hintCount <= 0;
          }
        }

        updateProgress();
        saveGameState();
      }
      
      function renderLetters(shuffledLetters) {
          letterContainer.innerHTML = '';
          const outerLetters = shuffledLetters || currentGame.letras.filter(l => l !== currentGame.central);
          const tempBtn = document.createElement('button');
          tempBtn.className = 'letter-btn';
          tempBtn.style.visibility = 'hidden';
          tempBtn.style.pointerEvents = 'none';
          tempBtn.style.left = '50%';
          tempBtn.style.top = '50%';
          letterContainer.appendChild(tempBtn);
          const btnRect = tempBtn.getBoundingClientRect();
          const buttonDiameter = btnRect.width || 70;
          tempBtn.remove();

          const containerSize = Math.min(letterContainer.offsetWidth, letterContainer.offsetHeight);
          const rawRadius = containerSize / 2 - buttonDiameter / 2 - 6;
          const radius = Math.max(rawRadius, 0);
          const angleStep = (2 * Math.PI) / outerLetters.length;

          outerLetters.forEach((letter, i) => {
              const angle = i * angleStep - (Math.PI / 2);
              const x = radius * Math.cos(angle) + (letterContainer.offsetWidth / 2) - (buttonDiameter / 2);
              const y = radius * Math.sin(angle) + (letterContainer.offsetHeight / 2) - (buttonDiameter / 2);
              
              const btn = document.createElement('button');
              btn.className = 'letter-btn';
              btn.textContent = letter;
              btn.dataset.letter = letter;
              btn.style.left = `${x}px`;
              btn.style.top = `${y}px`;
              letterContainer.appendChild(btn);
          });

          const centralBtn = document.createElement('button');
          centralBtn.className = 'letter-btn central';
          centralBtn.textContent = currentGame.central;
          centralBtn.dataset.letter = currentGame.central;
          letterContainer.appendChild(centralBtn);
          
          attachLetterListeners();
      }

      function renderWordPlaceholders() {
        foundWordsList.innerHTML = '';
        wordPlaceholders.clear();
        const sortedWords = [...currentGame.palavras].sort((a, b) => a.length - b.length || a.localeCompare(b));

        sortedWords.forEach(word => {
            const li = document.createElement('li');
            li.className = 'placeholder';
            li.textContent = '_ '.repeat(word.length).trim();
            li.dataset.word = word;
            foundWordsList.appendChild(li);
            wordPlaceholders.set(word, li);
        });
      }

      function attachLetterListeners() {
        document.querySelectorAll('.letter-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                if (gameEnded) return;
                currentWord += btn.dataset.letter;
                wordDisplay.textContent = currentWord;
            });
        });
      }

      function shuffleLetters() {
        if (gameEnded) return;
        const outerLetters = currentGame.letras.filter(l => l !== currentGame.central);
        for (let i = outerLetters.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [outerLetters[i], outerLetters[j]] = [outerLetters[j], outerLetters[i]];
        }
        renderLetters(outerLetters);
      }

      function confirmWord() {
        if (gameEnded) {
            showFeedback('A partida já foi encerrada.', 'info');
            return;
        }
        const word = currentWord.toLowerCase();

        if (word.length < 4) {
            showFeedback('A palavra deve ter no mínimo 4 letras.', 'error');
            return;
        }
        if (!word.includes(currentGame.central.toLowerCase())) {
            showFeedback('A palavra deve conter a letra central.', 'error');
            return;
        }
        if (foundWords.includes(word)) {
            showFeedback('Palavra já encontrada!', 'info');
            clearCurrentWord();
            return;
        }
        if (currentGame.palavras.includes(word)) {
            foundWords.push(word);
            revealFoundWord(word);
            addScore(word.length);
            updateProgress();
            saveGameState();
            showFeedback('Boa!', 'success');
        } else {
            showFeedback('Palavra inválida.', 'error');
        }
        clearCurrentWord();
      }
      
      function clearCurrentWord() {
        currentWord = '';
        wordDisplay.textContent = '';
      }

      function revealFoundWord(word, { scroll = true } = {}) {
        const li = wordPlaceholders.get(word);
        if (li) {
            li.textContent = word.toUpperCase();
            li.classList.remove('placeholder', 'hinted', 'revealed');
            li.classList.add('found');
            if (scroll) {
              li.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }
        }
        placeholderOverrides.delete(word);
      }

      function provideHint() {
        if (gameEnded) return;
        if (hintCount <= 0) {
            showFeedback('Você não tem mais dicas!', 'error');
            return;
        }

        const unFoundWords = currentGame.palavras.filter(p => !foundWords.includes(p));
        const unHintedWords = unFoundWords.filter(word => {
            const li = wordPlaceholders.get(word);
            return li && !li.classList.contains('hinted');
        });

        if (unHintedWords.length === 0) {
            showFeedback('Nenhuma dica nova disponível.', 'info');
            return;
        }

        const wordToHint = unHintedWords[Math.floor(Math.random() * unHintedWords.length)];
        const li = wordPlaceholders.get(wordToHint);

        if (!li) return;

        const word = wordToHint;
        let numToReveal = 2;
        if (word.length >= 8) {
            numToReveal = 3;
        }

        const wordAsArray = Array(word.length).fill('_');
        let indicesToReveal = new Set();
        while(indicesToReveal.size < numToReveal) {
            indicesToReveal.add(Math.floor(Math.random() * word.length));
        }

        for(let i = 0; i < word.length; i++) {
            if(indicesToReveal.has(i)) {
                wordAsArray[i] = word[i].toUpperCase();
            }
        }

        li.textContent = wordAsArray.join(' ');
        li.classList.add('hinted');

        hintCount--;
        hintCountSpan.textContent = hintCount;
        if (hintCount <= 0) {
            hintBtn.disabled = true;
        }
        placeholderOverrides.set(wordToHint, li.textContent);
        saveGameState();
      }

      function updateProgress() {
        const foundCount = foundWords.length;
        const totalCount = currentGame.palavras.length;
        const percentage = totalCount > 0 ? (foundCount / totalCount) * 100 : 0;

        wordsFoundCount.textContent = foundCount;
        progressBar.style.width = `${percentage}%`;
        if (percentage >= END_GAME_THRESHOLD) {
            endGameWarning.textContent = '';
        }
        
        updateQualification(percentage);
      }

      function addScore(points) {
        score += points;
        scoreCount.textContent = score;
      }

      function applyPlaceholderOverrides() {
        if (!placeholderOverrides.size) return;
        const toRemove = [];
        placeholderOverrides.forEach((text, word) => {
          if (foundWords.includes(word)) {
            toRemove.push(word);
            return;
          }
          const li = wordPlaceholders.get(word);
          if (li) {
            li.textContent = text;
            li.classList.add('hinted');
          }
        });
        toRemove.forEach(word => placeholderOverrides.delete(word));
      }

      function saveGameState() {
        if (!storageKey) return;
        try {
          const elapsedMs = Math.max(0, Math.floor(getElapsedMs()));
          const state = {
            foundWords,
            hintCount,
            score,
            gameEnded,
            placeholderOverrides: Array.from(placeholderOverrides.entries()),
            elapsedMs,
          };
          localStorage.setItem(storageKey, JSON.stringify(state));
          elapsedMsBase = elapsedMs;
          sessionStartTime = gameEnded ? null : Date.now();
        } catch (error) {
          console.error('Não foi possível salvar o estado do jogo.', error);
        }
      }

      function loadGameState() {
        if (!storageKey) return null;
        try {
          const stored = localStorage.getItem(storageKey);
          if (!stored) return null;
          return JSON.parse(stored);
        } catch (error) {
          console.error('Não foi possível carregar o estado do jogo.', error);
          return null;
        }
      }

      function handleEndGame() {
        if (!currentGame || gameEnded) return;
        const totalCount = currentGame.palavras.length;
        const percentage = totalCount > 0 ? (foundWords.length / totalCount) * 100 : 0;

        if (percentage < END_GAME_THRESHOLD) {
            endGameWarning.textContent = `Você precisa encontrar pelo menos ${END_GAME_THRESHOLD}% das palavras para encerrar.`;
            setTimeout(() => {
              if (!gameEnded) {
                endGameWarning.textContent = '';
              }
            }, 2000);
            return;
        }

        endGameWarning.textContent = '';
        gameEnded = true;
        showFeedback('Partida encerrada! Confira todas as palavras.', 'success');
        revealAllWords();
        disableLetterButtons();
        clearCurrentWord();
        confirmBtn.disabled = true;
        shuffleBtn.disabled = true;
        hintBtn.disabled = true;
        deleteBtn.disabled = true;
        endGameBtn.disabled = true;
        placeholderOverrides.clear();
        saveGameState();
      }

      function revealAllWords() {
        wordPlaceholders.forEach((li, word) => {
            li.textContent = word.toUpperCase();
            li.classList.remove('placeholder', 'hinted', 'found', 'revealed');
            if (foundWords.includes(word)) {
                li.classList.add('found');
            } else {
                li.classList.add('revealed');
            }
        });
      }

      function disableLetterButtons() {
        document.querySelectorAll('.letter-btn').forEach(btn => {
            btn.disabled = true;
        });
      }
      
      function updateQualification(percentage) {
          let text = 'Iniciante';
          if (percentage >= 100) text = 'Genial!';
          else if (percentage >= 80) text = 'Fantástico!';
          else if (percentage >= 60) text = 'Excelente!';
          else if (percentage >= 40) text = 'Muito Bom!';
          else if (percentage >= 20) text = 'Bom Trabalho!';
          else if (percentage > 0) text = 'Continue Assim!';
          qualificationText.textContent = text;
      }

      // Event Listeners
      deleteBtn.addEventListener('click', () => {
        if (gameEnded) return;
        currentWord = currentWord.slice(0, -1);
        wordDisplay.textContent = currentWord;
      });

      shuffleBtn.addEventListener('click', shuffleLetters);
      confirmBtn.addEventListener('click', confirmWord);
      hintBtn.addEventListener('click', provideHint);
      endGameBtn.addEventListener('click', handleEndGame);
      helpBtn.addEventListener('click', () => openModal('tutorial'));
      if (statsBtn) {
        statsBtn.addEventListener('click', () => openModal('stats'));
      }
      creditsBtn.addEventListener('click', () => openModal('credits'));
      modalCloseBtn.addEventListener('click', closeModal);
      infoModal.addEventListener('click', (e) => {
        if (e.target === infoModal) {
          closeModal();
        }
      });

      // Blur pointer-activated buttons to avoid repeated activation on Enter.
      const pointerButtons = [
        hintBtn,
        deleteBtn,
        shuffleBtn,
        confirmBtn,
        endGameBtn,
        helpBtn,
        statsBtn,
        creditsBtn,
      ].filter(Boolean);

      const blurAfterPointerClick = (event) => {
        if (event.detail > 0) {
          event.currentTarget.blur();
        }
      };

      pointerButtons.forEach((btn) => {
        btn.addEventListener('click', blurAfterPointerClick);
      });

      document.addEventListener('keydown', (e) => {
        if (infoModal.classList.contains('active')) {
          if (e.key === 'Escape') {
            closeModal();
          }
          return;
        }
        if (gameEnded) return;
        const key = e.key.toUpperCase();
        if (currentGame && (currentGame.letras.includes(key) || currentGame.central === key) ) {
            currentWord += key;
            wordDisplay.textContent = currentWord;
        } else if (e.key === 'Backspace') {
            currentWord = currentWord.slice(0, -1);
            wordDisplay.textContent = currentWord;
        } else if (e.key === 'Enter') {
            confirmBtn.click(); // Trigger click to handle disabled state etc.
        }
      });

      loadJogos();
      openModal('tutorial');
    });
  </script>
</body>
</html>
